<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Applied Statistics with R</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Applied Statistics with <code>R</code>">
  <meta name="generator" content="bookdown 0.1.3 and GitBook 2.6.7">

  <meta property="og:title" content="Applied Statistics with R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://daviddalpiaz.github.io/appliedstats/" />
  
  
  <meta name="github-repo" content="daviddalpiaz/appliedstats" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Applied Statistics with R" />
  
  
  

<meta name="author" content="David Dalpiaz">

<meta name="date" content="2016-07-23">

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="categorical-predictors-and-interactions.html">
<link rel="next" href="transformations.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Applied Statistics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#about-this-book"><i class="fa fa-check"></i><b>1.1</b> About This Book</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#conventions"><i class="fa fa-check"></i><b>1.2</b> Conventions</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i><b>1.3</b> Acknowledgements</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i><b>1.4</b> License</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-r.html"><a href="introduction-to-r.html"><i class="fa fa-check"></i><b>2</b> Introduction to <code>R</code></a><ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#r-resources"><i class="fa fa-check"></i><b>2.1</b> <code>R</code> Resources</a></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#r-basics"><i class="fa fa-check"></i><b>2.2</b> <code>R</code> Basics</a><ul>
<li class="chapter" data-level="2.2.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#basic-calculations"><i class="fa fa-check"></i><b>2.2.1</b> Basic Calculations</a></li>
<li class="chapter" data-level="2.2.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#getting-help"><i class="fa fa-check"></i><b>2.2.2</b> Getting Help</a></li>
<li class="chapter" data-level="2.2.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#installing-packages"><i class="fa fa-check"></i><b>2.2.3</b> Installing Packages</a></li>
<li class="chapter" data-level="2.2.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#data-types"><i class="fa fa-check"></i><b>2.2.4</b> Data Types</a></li>
<li class="chapter" data-level="2.2.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#vectors"><i class="fa fa-check"></i><b>2.2.5</b> Vectors</a></li>
<li class="chapter" data-level="2.2.6" data-path="introduction-to-r.html"><a href="introduction-to-r.html#summary-statistics"><i class="fa fa-check"></i><b>2.2.6</b> Summary Statistics</a></li>
<li class="chapter" data-level="2.2.7" data-path="introduction-to-r.html"><a href="introduction-to-r.html#matrices"><i class="fa fa-check"></i><b>2.2.7</b> Matrices</a></li>
<li class="chapter" data-level="2.2.8" data-path="introduction-to-r.html"><a href="introduction-to-r.html#data-frames"><i class="fa fa-check"></i><b>2.2.8</b> Data Frames</a></li>
<li class="chapter" data-level="2.2.9" data-path="introduction-to-r.html"><a href="introduction-to-r.html#plotting"><i class="fa fa-check"></i><b>2.2.9</b> Plotting</a></li>
<li class="chapter" data-level="2.2.10" data-path="introduction-to-r.html"><a href="introduction-to-r.html#distributions"><i class="fa fa-check"></i><b>2.2.10</b> Distributions</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#programming-basics"><i class="fa fa-check"></i><b>2.3</b> Programming Basics</a><ul>
<li class="chapter" data-level="2.3.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#logical-operators"><i class="fa fa-check"></i><b>2.3.1</b> Logical Operators</a></li>
<li class="chapter" data-level="2.3.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#control-flow"><i class="fa fa-check"></i><b>2.3.2</b> Control Flow</a></li>
<li class="chapter" data-level="2.3.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#functions"><i class="fa fa-check"></i><b>2.3.3</b> Functions</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#hypothesis-tests-in-r"><i class="fa fa-check"></i><b>2.4</b> Hypothesis Tests in <code>R</code></a><ul>
<li class="chapter" data-level="2.4.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#one-sample-t-test-review"><i class="fa fa-check"></i><b>2.4.1</b> One Sample t-Test: Review</a></li>
<li class="chapter" data-level="2.4.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#one-sample-t-test-example"><i class="fa fa-check"></i><b>2.4.2</b> One Sample t-Test: Example</a></li>
<li class="chapter" data-level="2.4.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#two-sample-t-test-review"><i class="fa fa-check"></i><b>2.4.3</b> Two Sample t-Test: Review</a></li>
<li class="chapter" data-level="2.4.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#two-sample-t-test-example"><i class="fa fa-check"></i><b>2.4.4</b> Two Sample t-Test: Example</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#simulation"><i class="fa fa-check"></i><b>2.5</b> Simulation</a><ul>
<li class="chapter" data-level="2.5.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#paired-differences"><i class="fa fa-check"></i><b>2.5.1</b> Paired Differences</a></li>
<li class="chapter" data-level="2.5.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#distribution-of-a-sample-mean"><i class="fa fa-check"></i><b>2.5.2</b> Distribution of a Sample Mean</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="simple-linear-regression.html"><a href="simple-linear-regression.html"><i class="fa fa-check"></i><b>3</b> Simple Linear Regression</a><ul>
<li class="chapter" data-level="3.1" data-path="simple-linear-regression.html"><a href="simple-linear-regression.html#modeling"><i class="fa fa-check"></i><b>3.1</b> Modeling</a><ul>
<li class="chapter" data-level="3.1.1" data-path="simple-linear-regression.html"><a href="simple-linear-regression.html#simple-linear-regression-model"><i class="fa fa-check"></i><b>3.1.1</b> Simple Linear Regression Model</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="simple-linear-regression.html"><a href="simple-linear-regression.html#least-squares-approach"><i class="fa fa-check"></i><b>3.2</b> Least Squares Approach</a><ul>
<li class="chapter" data-level="3.2.1" data-path="simple-linear-regression.html"><a href="simple-linear-regression.html#making-predictions"><i class="fa fa-check"></i><b>3.2.1</b> Making Predictions</a></li>
<li class="chapter" data-level="3.2.2" data-path="simple-linear-regression.html"><a href="simple-linear-regression.html#residuals"><i class="fa fa-check"></i><b>3.2.2</b> Residuals</a></li>
<li class="chapter" data-level="3.2.3" data-path="simple-linear-regression.html"><a href="simple-linear-regression.html#variance-estimation"><i class="fa fa-check"></i><b>3.2.3</b> Variance Estimation</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="simple-linear-regression.html"><a href="simple-linear-regression.html#decomposition-of-variation"><i class="fa fa-check"></i><b>3.3</b> Decomposition of Variation</a><ul>
<li class="chapter" data-level="3.3.1" data-path="simple-linear-regression.html"><a href="simple-linear-regression.html#coefficient-of-determination"><i class="fa fa-check"></i><b>3.3.1</b> Coefficient of Determination</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="simple-linear-regression.html"><a href="simple-linear-regression.html#the-lm-function"><i class="fa fa-check"></i><b>3.4</b> The <code>lm</code> Function</a></li>
<li class="chapter" data-level="3.5" data-path="simple-linear-regression.html"><a href="simple-linear-regression.html#maximum-likelihood-estimation-mle-approach"><i class="fa fa-check"></i><b>3.5</b> Maximum Likelihood Estimation (MLE) Approach</a></li>
<li class="chapter" data-level="3.6" data-path="simple-linear-regression.html"><a href="simple-linear-regression.html#simulating-slr"><i class="fa fa-check"></i><b>3.6</b> Simulating SLR</a></li>
<li class="chapter" data-level="3.7" data-path="simple-linear-regression.html"><a href="simple-linear-regression.html#history"><i class="fa fa-check"></i><b>3.7</b> History</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="inference-for-simple-linear-regression.html"><a href="inference-for-simple-linear-regression.html"><i class="fa fa-check"></i><b>4</b> Inference for Simple Linear Regression</a><ul>
<li class="chapter" data-level="4.1" data-path="inference-for-simple-linear-regression.html"><a href="inference-for-simple-linear-regression.html#gaussmarkov-theorem"><i class="fa fa-check"></i><b>4.1</b> Gauss–Markov Theorem</a></li>
<li class="chapter" data-level="4.2" data-path="inference-for-simple-linear-regression.html"><a href="inference-for-simple-linear-regression.html#sampling-distributions"><i class="fa fa-check"></i><b>4.2</b> Sampling Distributions</a><ul>
<li class="chapter" data-level="4.2.1" data-path="inference-for-simple-linear-regression.html"><a href="inference-for-simple-linear-regression.html#simulating-sampling-distributions"><i class="fa fa-check"></i><b>4.2.1</b> Simulating Sampling Distributions</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="inference-for-simple-linear-regression.html"><a href="inference-for-simple-linear-regression.html#standard-errors"><i class="fa fa-check"></i><b>4.3</b> Standard Errors</a></li>
<li class="chapter" data-level="4.4" data-path="inference-for-simple-linear-regression.html"><a href="inference-for-simple-linear-regression.html#confidence-intervals-for-slope-and-intercept"><i class="fa fa-check"></i><b>4.4</b> Confidence Intervals for Slope and Intercept</a></li>
<li class="chapter" data-level="4.5" data-path="inference-for-simple-linear-regression.html"><a href="inference-for-simple-linear-regression.html#hypothesis-tests"><i class="fa fa-check"></i><b>4.5</b> Hypothesis Tests</a></li>
<li class="chapter" data-level="4.6" data-path="inference-for-simple-linear-regression.html"><a href="inference-for-simple-linear-regression.html#cars-example"><i class="fa fa-check"></i><b>4.6</b> <code>cars</code> Example</a><ul>
<li class="chapter" data-level="4.6.1" data-path="inference-for-simple-linear-regression.html"><a href="inference-for-simple-linear-regression.html#tests-in-r"><i class="fa fa-check"></i><b>4.6.1</b> Tests in <code>R</code></a></li>
<li class="chapter" data-level="4.6.2" data-path="inference-for-simple-linear-regression.html"><a href="inference-for-simple-linear-regression.html#significance-of-regression-t-test"><i class="fa fa-check"></i><b>4.6.2</b> Significance of Regression, t-Test</a></li>
<li class="chapter" data-level="4.6.3" data-path="inference-for-simple-linear-regression.html"><a href="inference-for-simple-linear-regression.html#confidence-intervals-in-r"><i class="fa fa-check"></i><b>4.6.3</b> Confidence Intervals in <code>R</code></a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="inference-for-simple-linear-regression.html"><a href="inference-for-simple-linear-regression.html#confidence-interval-for-mean-response"><i class="fa fa-check"></i><b>4.7</b> Confidence Interval for Mean Response</a></li>
<li class="chapter" data-level="4.8" data-path="inference-for-simple-linear-regression.html"><a href="inference-for-simple-linear-regression.html#prediction-interval-for-new-observations"><i class="fa fa-check"></i><b>4.8</b> Prediction Interval for New Observations</a></li>
<li class="chapter" data-level="4.9" data-path="inference-for-simple-linear-regression.html"><a href="inference-for-simple-linear-regression.html#confidence-and-prediction-bands"><i class="fa fa-check"></i><b>4.9</b> Confidence and Prediction Bands</a></li>
<li class="chapter" data-level="4.10" data-path="inference-for-simple-linear-regression.html"><a href="inference-for-simple-linear-regression.html#significance-of-regression-f-test"><i class="fa fa-check"></i><b>4.10</b> Significance of Regression, F-Test</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html"><i class="fa fa-check"></i><b>5</b> Multiple Linear Regression</a><ul>
<li class="chapter" data-level="5.1" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#matrix-approach-to-regression"><i class="fa fa-check"></i><b>5.1</b> Matrix Approach to Regression</a></li>
<li class="chapter" data-level="5.2" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#sampling-distribution"><i class="fa fa-check"></i><b>5.2</b> Sampling Distribution</a><ul>
<li class="chapter" data-level="5.2.1" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#single-parameter-tests"><i class="fa fa-check"></i><b>5.2.1</b> Single Parameter Tests</a></li>
<li class="chapter" data-level="5.2.2" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#confidence-intervals"><i class="fa fa-check"></i><b>5.2.2</b> Confidence Intervals</a></li>
<li class="chapter" data-level="5.2.3" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#confidence-intervals-for-mean-response"><i class="fa fa-check"></i><b>5.2.3</b> Confidence Intervals for Mean Response</a></li>
<li class="chapter" data-level="5.2.4" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#prediction-intervals"><i class="fa fa-check"></i><b>5.2.4</b> Prediction Intervals</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#signifiance-of-regression"><i class="fa fa-check"></i><b>5.3</b> Signifiance of Regression</a></li>
<li class="chapter" data-level="5.4" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#nested-models"><i class="fa fa-check"></i><b>5.4</b> Nested Models</a></li>
<li class="chapter" data-level="5.5" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#simulation-1"><i class="fa fa-check"></i><b>5.5</b> Simulation</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html"><i class="fa fa-check"></i><b>6</b> Categorical Predictors and Interactions</a><ul>
<li class="chapter" data-level="6.1" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#dummy-variables"><i class="fa fa-check"></i><b>6.1</b> Dummy Variables</a></li>
<li class="chapter" data-level="6.2" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#interactions"><i class="fa fa-check"></i><b>6.2</b> Interactions</a></li>
<li class="chapter" data-level="6.3" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#factor-variables"><i class="fa fa-check"></i><b>6.3</b> Factor Variables</a><ul>
<li class="chapter" data-level="6.3.1" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#factors-with-more-than-two-levels"><i class="fa fa-check"></i><b>6.3.1</b> Factors with More Than Two Levels</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#parameterization"><i class="fa fa-check"></i><b>6.4</b> Parameterization</a></li>
<li class="chapter" data-level="6.5" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#building-larger-models"><i class="fa fa-check"></i><b>6.5</b> Building Larger Models</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="model-diagnostics.html"><a href="model-diagnostics.html"><i class="fa fa-check"></i><b>7</b> Model Diagnostics</a><ul>
<li class="chapter" data-level="7.1" data-path="model-diagnostics.html"><a href="model-diagnostics.html#model-assumptions"><i class="fa fa-check"></i><b>7.1</b> Model Assumptions</a></li>
<li class="chapter" data-level="7.2" data-path="model-diagnostics.html"><a href="model-diagnostics.html#checking-assumptions"><i class="fa fa-check"></i><b>7.2</b> Checking Assumptions</a><ul>
<li class="chapter" data-level="7.2.1" data-path="model-diagnostics.html"><a href="model-diagnostics.html#fitted-versus-residuals-plot"><i class="fa fa-check"></i><b>7.2.1</b> Fitted versus Residuals Plot</a></li>
<li class="chapter" data-level="7.2.2" data-path="model-diagnostics.html"><a href="model-diagnostics.html#breusch-pagan-test"><i class="fa fa-check"></i><b>7.2.2</b> Breusch-Pagan Test</a></li>
<li class="chapter" data-level="7.2.3" data-path="model-diagnostics.html"><a href="model-diagnostics.html#histograms-1"><i class="fa fa-check"></i><b>7.2.3</b> Histograms</a></li>
<li class="chapter" data-level="7.2.4" data-path="model-diagnostics.html"><a href="model-diagnostics.html#q-q-plots"><i class="fa fa-check"></i><b>7.2.4</b> Q-Q Plots</a></li>
<li class="chapter" data-level="7.2.5" data-path="model-diagnostics.html"><a href="model-diagnostics.html#shapiro-wilk-test"><i class="fa fa-check"></i><b>7.2.5</b> Shapiro-Wilk Test</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="model-diagnostics.html"><a href="model-diagnostics.html#unusual-observations"><i class="fa fa-check"></i><b>7.3</b> Unusual Observations</a><ul>
<li class="chapter" data-level="7.3.1" data-path="model-diagnostics.html"><a href="model-diagnostics.html#leverage"><i class="fa fa-check"></i><b>7.3.1</b> Leverage</a></li>
<li class="chapter" data-level="7.3.2" data-path="model-diagnostics.html"><a href="model-diagnostics.html#outliers"><i class="fa fa-check"></i><b>7.3.2</b> Outliers</a></li>
<li class="chapter" data-level="7.3.3" data-path="model-diagnostics.html"><a href="model-diagnostics.html#influence"><i class="fa fa-check"></i><b>7.3.3</b> Influence</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="model-diagnostics.html"><a href="model-diagnostics.html#data-analysis-examples"><i class="fa fa-check"></i><b>7.4</b> Data Analysis Examples</a><ul>
<li class="chapter" data-level="7.4.1" data-path="model-diagnostics.html"><a href="model-diagnostics.html#good-diagnostics"><i class="fa fa-check"></i><b>7.4.1</b> Good Diagnostics</a></li>
<li class="chapter" data-level="7.4.2" data-path="model-diagnostics.html"><a href="model-diagnostics.html#suspect-diagnostics"><i class="fa fa-check"></i><b>7.4.2</b> Suspect Diagnostics</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="transformations.html"><a href="transformations.html"><i class="fa fa-check"></i><b>8</b> Transformations</a><ul>
<li class="chapter" data-level="8.1" data-path="transformations.html"><a href="transformations.html#response-transformation"><i class="fa fa-check"></i><b>8.1</b> Response Transformation</a><ul>
<li class="chapter" data-level="8.1.1" data-path="transformations.html"><a href="transformations.html#variance-stabilizing-transformations"><i class="fa fa-check"></i><b>8.1.1</b> Variance Stabilizing Transformations</a></li>
<li class="chapter" data-level="8.1.2" data-path="transformations.html"><a href="transformations.html#box-cox-transformations"><i class="fa fa-check"></i><b>8.1.2</b> Box-Cox Transformations</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="transformations.html"><a href="transformations.html#predictor-transformation"><i class="fa fa-check"></i><b>8.2</b> Predictor Transformation</a><ul>
<li class="chapter" data-level="8.2.1" data-path="transformations.html"><a href="transformations.html#polynomials"><i class="fa fa-check"></i><b>8.2.1</b> Polynomials</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="collinearity.html"><a href="collinearity.html"><i class="fa fa-check"></i><b>9</b> Collinearity</a><ul>
<li class="chapter" data-level="9.1" data-path="collinearity.html"><a href="collinearity.html#exact-collinearity"><i class="fa fa-check"></i><b>9.1</b> Exact Collinearity</a></li>
<li class="chapter" data-level="9.2" data-path="collinearity.html"><a href="collinearity.html#collinearity-1"><i class="fa fa-check"></i><b>9.2</b> Collinearity</a><ul>
<li class="chapter" data-level="9.2.1" data-path="collinearity.html"><a href="collinearity.html#variance-inflation-factor."><i class="fa fa-check"></i><b>9.2.1</b> Variance Inflation Factor.</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="collinearity.html"><a href="collinearity.html#simulation-2"><i class="fa fa-check"></i><b>9.3</b> Simulation</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/daviddalpiaz/appliedstats" target="blank">&copy; 2016 David Dalpiaz</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Applied Statistics with <code>R</code></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="model-diagnostics" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> Model Diagnostics</h1>
<blockquote>
<p>“Your assumptions are your windows on the world. Scrub them off every once in a while, or the light won’t come in.”</p>
<p>— <strong>Isaac Asimov</strong></p>
</blockquote>
<p>After reading this chapter you will be able to:</p>
<ul>
<li>Understand the assumptions of a regression model.</li>
<li>Assess regression model assumptions using visualizations and tests.</li>
<li>Understand leverage, outliers, and influential points.</li>
<li>Be able to identify unusual observations in regression models.</li>
</ul>
<div id="model-assumptions" class="section level2">
<h2><span class="header-section-number">7.1</span> Model Assumptions</h2>
<p>Recall the multiple linear regression model that we have defined.</p>
<p><span class="math display">\[
Y_i = \beta_0 + \beta_1 x_{i1} + \beta_2 x_{i2} + \cdots + \beta_{p-1} x_{i(p-1)} + \epsilon_i, \qquad i = 1, 2, \ldots, n.
\]</span></p>
<p>Using matrix notation, this model can be written much more succinctly as</p>
<p><span class="math display">\[
Y = X \beta + \epsilon.
\]</span></p>
<p>Given data, we found the estimates for the <span class="math inline">\(\beta\)</span> parameters using</p>
<p><span class="math display">\[
\hat{\beta} = \left(  X^\top X  \right)^{-1}X^\top y.
\]</span></p>
<p>We than noted that these estimates had mean</p>
<p><span class="math display">\[
E[\hat{\beta}] = \beta,
\]</span></p>
<p>and variance</p>
<p><span class="math display">\[
Var[\hat{\beta}] = \sigma^2 \left(  X^\top X  \right)^{-1}.
\]</span></p>
<p>In particular, an individual parameter, say <span class="math inline">\(\hat{\beta}_j\)</span> had a normal distribution</p>
<p><span class="math display">\[
\hat{\beta}_j \sim N\left(\beta_j, \sigma^2 C_{jj}  \right)
\]</span></p>
<p>where <span class="math inline">\(C\)</span> was the matrix defined as</p>
<p><span class="math display">\[
C = \left(X^\top X\right)^{-1}.
\]</span></p>
<p>We then used this fact to define</p>
<p><span class="math display">\[
\frac{\hat{\beta}_j - \beta_j}{s_e \sqrt{C_{jj}}} \sim t_{n-p},
\]</span></p>
<p>which we used to perform hypothesis testing.</p>
<p>So far we have looked at various metrics such as RMSE, RSE and <span class="math inline">\(R^2\)</span> to determine how well our model fit our data. Each of these in some way considers the expression</p>
<p><span class="math display">\[
\sum_{i = 1}^n (y_i - \hat{y}_i)^2.
\]</span></p>
<p>So, essentially each of these looks at how close the data points are to the model. However is that all we care about?</p>
<ul>
<li>It could be that the errors are made in a systematic way, which means that our model is misspecified. We may need additional interaction terms, or polynomial terms which we will see later.</li>
<li>It is also possible that at a particular set of predictor values, the errors are very small, but at a different set of predictor values, the errors are large.</li>
<li>Perhaps most of the errors are very small, but some are very large. This would suggest that the errors do not follow a normal distribution.</li>
</ul>
<p>Are these issues that we care about? If all we would like to do is predict, possibly not, since we would only care about the size of our errors. However, if we would like to perform inference, for example to determine if a particular predictor is important, we care a great deal. All of the distributional results, such as a <span class="math inline">\(t\)</span>-test for a single predictor, are derived under the assumptions of our model.</p>
<p>Technically, the assumptions of the model are encoded directly in a model statement such as,</p>
<p><span class="math display">\[
Y_i = \beta_0 + \beta_1 x_{i1} + \beta_2 x_{i2} + \cdots + \beta_{p-1} x_{i(p-1)} + \epsilon_i
\]</span></p>
<p>where <span class="math inline">\(\epsilon_i \sim N(0, \sigma^2).\)</span></p>
<p>Often, the <strong>assumptions of linear regression</strong>, are stated as,</p>
<ul>
<li><strong>L</strong>inearity: the response can be written as a linear combination of the predictors. (With noise about this true linear relationship.)</li>
<li><strong>I</strong>ndependence: the errors are independent.</li>
<li><strong>N</strong>ormality: the distribution of the errors should follow a normal distribution.</li>
<li><strong>E</strong>qual Variance: the error variance is the same at any set of predictor values.</li>
</ul>
<p>The linearity assumption is encoded as</p>
<p><span class="math display">\[
\beta_0 + \beta_1 x_{i1} + \beta_2 x_{i2} + \cdots + \beta_{p-1} x_{i(p-1)},
\]</span></p>
<p>while the remaining three, are all encoded in</p>
<p><span class="math display">\[
\epsilon_i \sim N(0, \sigma^2),
\]</span></p>
<p>since the <span class="math inline">\(\epsilon_i\)</span> are <span class="math inline">\(iid\)</span> normal random variables with constant variance.</p>
<p>If these assumptions are met, great! We can perform inference, <strong>and it is valid</strong>. If these assumptions are <em>not</em> met, we can still “perform” a <span class="math inline">\(t\)</span>-test using <code>R</code>, but the results are <strong>not valid</strong>. The distributions of the parameter estimates will not be what we expect. Hypothesis tests will then accept or reject incorrectly. Essentially, <strong>garbage in, garbage out.</strong></p>
</div>
<div id="checking-assumptions" class="section level2">
<h2><span class="header-section-number">7.2</span> Checking Assumptions</h2>
<p>We’ll now look at a number of tools for checking the assumptions of a linear model.</p>
<div id="fitted-versus-residuals-plot" class="section level3">
<h3><span class="header-section-number">7.2.1</span> Fitted versus Residuals Plot</h3>
<p>Probably our most useful tool will be a <strong>Fitted versus Residuals Plot</strong>. It will be useful for checking both the <strong>linearity</strong> and <strong>constant variance</strong> assumptions.</p>
<p>First, let’s consider a true SLR model,</p>
<p><span class="math display">\[
Y_i = 3 + 5x_i + \epsilon_i \quad \quad \epsilon_i \sim N(0, 1)
\]</span></p>
<p>This model does not violate any the assumptions, so we’ll use this to see what a good fitted versus residuals plot should look like. First, we’ll simulate observations from this model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n =<span class="st"> </span><span class="dv">500</span>
<span class="kw">set.seed</span>(<span class="dv">42</span>)
sim_data =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">runif</span>(n) *<span class="st"> </span><span class="dv">5</span>, <span class="dt">y =</span> <span class="kw">rep</span>(<span class="dv">0</span>, n))
sim_data$y =<span class="st"> </span><span class="dv">3</span> +<span class="st"> </span><span class="dv">5</span> *<span class="st"> </span>sim_data$x +<span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)
<span class="kw">head</span>(sim_data)</code></pre></div>
<pre><code>##          x         y
## 1 4.574030 24.773995
## 2 4.685377 26.475936
## 3 1.430698  8.954993
## 4 4.152238 23.951210
## 5 3.208728 20.341344
## 6 2.595480 14.943525</code></pre>
<p>We then fit the model and add the fitted line to a scatterplot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(y ~<span class="st"> </span>x, <span class="dt">data =</span> sim_data, <span class="dt">col =</span> <span class="st">&quot;dodgerblue&quot;</span>)
fit1 =<span class="st"> </span><span class="kw">lm</span>(y ~<span class="st"> </span>x, <span class="dt">data =</span> sim_data)
<span class="kw">abline</span>(fit1, <span class="dt">col =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="dt">lwd =</span> <span class="dv">3</span>)</code></pre></div>
<p><img src="applied_statistics_files/figure-html/unnamed-chunk-304-1.png" width="672" /></p>
<p>We now plot a fitted versus residuals plot. Note, this is residuals on the <span class="math inline">\(y\)</span>-axis despite the ordering in the name. Sometimes you will see this called a residuals versus fitted, or residuals versus predicted plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">fitted</span>(fit1), <span class="kw">resid</span>(fit1), <span class="dt">col =</span> <span class="st">&quot;dodgerblue&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;Fitted&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Residual&quot;</span>)
<span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>, <span class="dt">col =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="applied_statistics_files/figure-html/unnamed-chunk-305-1.png" width="672" /></p>
<p>We should look for two things in this plot.</p>
<ul>
<li>At any fitted value, the mean of the residuals should be roughly 0. If this is the case, the <em>linearity</em> assumption is valid. For this reason, we generally add a horizontal line at <span class="math inline">\(y = 0\)</span> to emphasize this point.</li>
<li>At every fitted value, the spread of the residuals should be roughly the same. If this is the case, the <em>constant variance</em> assumption is valid.</li>
</ul>
<p>Here we see this is the case for both.</p>
<p>To get a better idea of how a fitted versus residuals plot can be useful, we will simulate from models with violated assumptions.</p>
<p>We’ll first demonstrate a model with non-constant variance. In this case, the variance is larger for larger values of the predictor variable <span class="math inline">\(x\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_data2 =<span class="st"> </span>sim_data
sim_data2$y =<span class="st"> </span><span class="dv">3</span> +<span class="st"> </span><span class="dv">5</span> *<span class="st"> </span>sim_data2$x +<span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dv">0</span>, sim_data2$x)
fit2 =<span class="st"> </span><span class="kw">lm</span>(y ~<span class="st"> </span>x, <span class="dt">data =</span> sim_data2)
<span class="kw">plot</span>(y ~<span class="st"> </span>x, <span class="dt">data =</span> sim_data2, <span class="dt">col =</span> <span class="st">&quot;dodgerblue&quot;</span>)
<span class="kw">abline</span>(fit2, <span class="dt">col =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="dt">lwd =</span> <span class="dv">3</span>)</code></pre></div>
<p><img src="applied_statistics_files/figure-html/unnamed-chunk-306-1.png" width="672" /></p>
<p>This actually is rather easy to see here by added the fitted line to a scatterplot. This is because we are only performing simple linear regression. With multiple regression, a fitted versus residuals plot is a necessity, since adding a fitted regression to a scatterplot isn’t exactly possible.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">fitted</span>(fit2), <span class="kw">resid</span>(fit2), <span class="dt">col =</span> <span class="st">&quot;dodgerblue&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;Fitted&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Residual&quot;</span>)
<span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>, <span class="dt">col =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="applied_statistics_files/figure-html/unnamed-chunk-307-1.png" width="672" /></p>
<p>On the fitted versus residuals plot, we see two things very clearly. For any fitted value, the residuals seem roughly centered at 0. This is good! The linearity assumption is not violated. However, we also see very clearly, that for larger fitted values, the spread of the residuals is larger. This is bad! The constant variance assumption is violated here.</p>
<p>Now we will demonstrate a model which does not meet the linearity assumption.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_data3 =<span class="st"> </span>sim_data
sim_data3$y =<span class="st"> </span><span class="dv">3</span> +<span class="st"> </span><span class="dv">5</span> *<span class="st"> </span>sim_data3$x ^<span class="st"> </span><span class="dv">2</span> +<span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">5</span>)
fit3 =<span class="st"> </span><span class="kw">lm</span>(y ~<span class="st"> </span>x, <span class="dt">data =</span> sim_data3)
<span class="kw">plot</span>(y ~<span class="st"> </span>x, <span class="dt">data =</span> sim_data3, <span class="dt">col =</span> <span class="st">&quot;dodgerblue&quot;</span>)
<span class="kw">abline</span>(fit3, <span class="dt">col =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="dt">lwd =</span> <span class="dv">3</span>)</code></pre></div>
<p><img src="applied_statistics_files/figure-html/unnamed-chunk-308-1.png" width="672" /></p>
<p>Again, this is rather clear on the scatterplot, but again, we wouldn’t be able to check this plot for multiple regression.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">fitted</span>(fit3), <span class="kw">resid</span>(fit3), <span class="dt">col =</span> <span class="st">&quot;dodgerblue&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;Fitted&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Residual&quot;</span>)
<span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>, <span class="dt">col =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="applied_statistics_files/figure-html/unnamed-chunk-309-1.png" width="672" /></p>
<p>This time on the fitted versus residuals plot, for any fitted value, the spread of the residuals is about the same. However, they are not even close to centered at zero! At small and large fitted values the model is underestimating, while at medium fitted values, the model is overestimating. These are systematic errors, not random noise. So the constant variance assumption is met, but the linearity assumption is violated. Our model is simply wrong. We’re trying to fit a line to a curve!</p>
</div>
<div id="breusch-pagan-test" class="section level3">
<h3><span class="header-section-number">7.2.2</span> Breusch-Pagan Test</h3>
<p>Constant variance is often called <strong>homoscedasticity</strong>. Conversely, non-constant variance is called <strong>heteroscedasticity</strong>. We’ve seen how we can use a fitted versus residuals plot to look for these attributes.</p>
<p>While a fitted versus residuals plot can give us an idea about homoscedasticity, sometimes we would prefer a more formal test. There are many tests for constant variance, but here we will present one, the <a href="https://en.wikipedia.org/wiki/Breusch%E2%80%93Pagan_test"><strong>Breusch-Pagan Test</strong></a>. The exact details of the test will omitted here, but importantly the null and alternative can be considered to be,</p>
<ul>
<li><span class="math inline">\(H_0\)</span>: Homoscedasticity. The errors have constant variance about the true model.</li>
<li><span class="math inline">\(H_1\)</span>: Heteroscedasticity. The errors have non-constant variance about the true model.</li>
</ul>
<p>Isn’t that convenient? A test that will specifically test the <strong>constant variance</strong> assumption.</p>
<p>The Breusch-Pagan Test can not be performed by default in <code>R</code>, however the function <code>bptest</code> in the <code>lmtest</code> package implements the test.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#install.packages(&quot;lmtest&quot;)</span>
<span class="kw">library</span>(lmtest)</code></pre></div>
<p>Let’s try it on the three models we fit above. Recall,</p>
<ul>
<li><code>fit1</code> had no violation of assumptions,</li>
<li><code>fit2</code> violated the constant variance assumption, but not linearity,</li>
<li><code>fit3</code> violated linearity, but not constant variance.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">bptest</span>(fit1)</code></pre></div>
<pre><code>## 
##  studentized Breusch-Pagan test
## 
## data:  fit1
## BP = 1.0234, df = 1, p-value = 0.3117</code></pre>
<p>For <code>fit1</code> we see a large p-value, so we do not reject the null of homoscedasticity, which is what we would expect.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">bptest</span>(fit2)</code></pre></div>
<pre><code>## 
##  studentized Breusch-Pagan test
## 
## data:  fit2
## BP = 72.325, df = 1, p-value &lt; 2.2e-16</code></pre>
<p>For <code>fit2</code> we see a small p-value, so we reject the null of homoscedasticity. The constant variance assumption is violated. This matches our findings with a fitted versus residuals plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">bptest</span>(fit3)</code></pre></div>
<pre><code>## 
##  studentized Breusch-Pagan test
## 
## data:  fit3
## BP = 0.24035, df = 1, p-value = 0.624</code></pre>
<p>Lastly, for <code>fit3</code> we again see a large p-value, so we do not reject the null of homoscedasticity, which matches our findings with a fitted versus residuals plot.</p>
</div>
<div id="histograms-1" class="section level3">
<h3><span class="header-section-number">7.2.3</span> Histograms</h3>
<p>We have a number of tools for assessing the normality assumption. The most obvious would be to make a histogram of the residuals. If it appears roughly normal, then we’ll believe the errors could truly be normal.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))
<span class="kw">hist</span>(<span class="kw">resid</span>(fit1),
     <span class="dt">xlab   =</span> <span class="st">&quot;Residuals&quot;</span>,
     <span class="dt">main   =</span> <span class="st">&quot;Histogram of Residuals, fit1&quot;</span>,
     <span class="dt">col    =</span> <span class="st">&quot;darkorange&quot;</span>,
     <span class="dt">border =</span> <span class="st">&quot;dodgerblue&quot;</span>)
<span class="kw">hist</span>(<span class="kw">resid</span>(fit2),
     <span class="dt">xlab   =</span> <span class="st">&quot;Residuals&quot;</span>,
     <span class="dt">main   =</span> <span class="st">&quot;Histogram of Residuals, fit2&quot;</span>,
     <span class="dt">col    =</span> <span class="st">&quot;darkorange&quot;</span>,
     <span class="dt">border =</span> <span class="st">&quot;dodgerblue&quot;</span>)
<span class="kw">hist</span>(<span class="kw">resid</span>(fit3),
     <span class="dt">xlab   =</span> <span class="st">&quot;Residuals&quot;</span>,
     <span class="dt">main   =</span> <span class="st">&quot;Histogram of Residuals, fit3&quot;</span>,
     <span class="dt">col    =</span> <span class="st">&quot;darkorange&quot;</span>,
     <span class="dt">border =</span> <span class="st">&quot;dodgerblue&quot;</span>)</code></pre></div>
<p><img src="applied_statistics_files/figure-html/unnamed-chunk-314-1.png" width="672" /></p>
<p>Above are histograms for each of the three regression we have been considering. Notice that the first, for <code>fit1</code> appears very normal. The third, for <code>fit3</code>, appears to be very non-normal. However <code>fit2</code> is not as clear. It does have a rough bell shape, however, it also has a very sharp peak. For this reason we will usually use more powerful tools such as <strong>Q-Q plots</strong> and the <strong>Shapiro-Wilk test</strong> for assessing the normality of errors.</p>
</div>
<div id="q-q-plots" class="section level3">
<h3><span class="header-section-number">7.2.4</span> Q-Q Plots</h3>
<p>Another visual method for assessing the normality of errors, which is more powerful than a histogram, is a normal quantile-quantile plot, or <strong>Q-Q plot</strong> for short.</p>
<p>In <code>R</code> these are very easy to make. The <code>qqnorm()</code> function plots the points, and the <code>qqline()</code> function adds the necessary line. We create a Q-Q plot for the residuals of <code>fit1</code> to check if the errors could truly be normally distributed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qqnorm</span>(<span class="kw">resid</span>(fit1), <span class="dt">main =</span> <span class="st">&quot;Normal Q-Q Plot, fit1&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;dodgerblue&quot;</span>)
<span class="kw">qqline</span>(<span class="kw">resid</span>(fit1), <span class="dt">col =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="applied_statistics_files/figure-html/unnamed-chunk-315-1.png" width="672" /></p>
<p>In short, if the points of the plot do not closely follow a straight line, this would suggest that the data do not come from a normal distribution.</p>
<p>The calculations required to create the plot vary depending on the implementation, but essentially the <span class="math inline">\(y\)</span>-axis is the sorted data (observed, or sample quantiles), and the <span class="math inline">\(x\)</span>-axis is the values we would expect if the data did come from a normal distribution (theoretical quantiles).</p>
<p>The <a href="http://en.wikipedia.org/wiki/Normal_probability_plot">Wikipedia page for Normal probability plots</a> gives details on how this is implemented in <code>R</code> if you are interested.</p>
<p>Also, to get a better idea of how Q-Q plots work, here is a quick function which creates a Q-Q plot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">qq_plot =<span class="st"> </span>function(w) {

  n =<span class="st"> </span><span class="kw">length</span>(w)
  normal_quantiles =<span class="st"> </span><span class="kw">qnorm</span>(((<span class="dv">1</span>:n) /<span class="st"> </span>(n +<span class="st"> </span><span class="dv">1</span>)))

  <span class="co"># plot theoretical verus observed quantiles</span>
  <span class="kw">plot</span>(normal_quantiles, <span class="kw">sort</span>(w),
       <span class="dt">xlab =</span> <span class="kw">c</span>(<span class="st">&quot;Theoretical Quantiles&quot;</span>),
       <span class="dt">ylab =</span> <span class="kw">c</span>(<span class="st">&quot;Sample Quantiles&quot;</span>),
       <span class="dt">col =</span> <span class="st">&quot;dodgerblue&quot;</span>)
  <span class="kw">title</span>(<span class="st">&quot;Normal Q-Q Plot&quot;</span>)

  ## calculate line through the first and third quartiles  
  slope     =<span class="st"> </span>(<span class="kw">quantile</span>(w, <span class="fl">0.75</span>) -<span class="st"> </span><span class="kw">quantile</span>(w, <span class="fl">0.25</span>)) /<span class="st"> </span>(<span class="kw">qnorm</span>(<span class="fl">0.75</span>) -<span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.25</span>))
  intercept =<span class="st"> </span><span class="kw">quantile</span>(w, <span class="fl">0.25</span>) -<span class="st"> </span>slope *<span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.25</span>)

  <span class="co"># add to existing plot</span>
  <span class="kw">abline</span>(intercept, slope, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&quot;darkorange&quot;</span>)
}</code></pre></div>
<p>We can then verify that it is essentially equivalent to using <code>qqnorm()</code> and <code>qqline()</code> in <code>R</code>. There are <em>slight</em> differences, but the general idea is the same.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">420</span>)
x =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dt">mean =</span> <span class="dv">0</span> , <span class="dt">sd =</span> <span class="dv">1</span>)
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw">qqnorm</span>(x, <span class="dt">col =</span> <span class="st">&quot;dodgerblue&quot;</span>)
<span class="kw">qqline</span>(x, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&quot;darkorange&quot;</span>)
<span class="kw">qq_plot</span>(x)</code></pre></div>
<p><img src="applied_statistics_files/figure-html/unnamed-chunk-317-1.png" width="672" /></p>
<p>To get a better idea of what “close to the line” means, we perform a number of simulations, and create Q-Q plots.</p>
<p>First we simulate data from a normal distribution with different sample sizes, and each time create a Q-Q plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))
<span class="kw">set.seed</span>(<span class="dv">420</span>)
<span class="kw">qq_plot</span>(<span class="kw">rnorm</span>(<span class="dv">10</span>))
<span class="kw">qq_plot</span>(<span class="kw">rnorm</span>(<span class="dv">25</span>))
<span class="kw">qq_plot</span>(<span class="kw">rnorm</span>(<span class="dv">100</span>))</code></pre></div>
<p><img src="applied_statistics_files/figure-html/unnamed-chunk-318-1.png" width="768" /></p>
<p>Since this data <strong>is</strong> sampled from a normal distribution, these are all, by definition, good Q-Q plots. The points are “close to the line” and we would conclude that this data could have been sampled from a normal distribution. Notice in the first plot, one point is <em>somewhat</em> far from the line, but just one point, in combination with the small sample size, is not enough to make us worried. We see with the large sample size, all of the points are rather close to the line.</p>
<p>Next, we simulate data from a <span class="math inline">\(t\)</span> distribution with a small degrees of freedom, for different sample sizes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))
<span class="kw">set.seed</span>(<span class="dv">420</span>)
<span class="kw">qq_plot</span>(<span class="kw">rt</span>(<span class="dv">10</span>, <span class="dt">df =</span> <span class="dv">4</span>))
<span class="kw">qq_plot</span>(<span class="kw">rt</span>(<span class="dv">25</span>, <span class="dt">df =</span> <span class="dv">4</span>))
<span class="kw">qq_plot</span>(<span class="kw">rt</span>(<span class="dv">100</span>, <span class="dt">df =</span> <span class="dv">4</span>))</code></pre></div>
<p><img src="applied_statistics_files/figure-html/unnamed-chunk-319-1.png" width="768" /></p>
<p>Recall, that as the degrees of freedom for a <span class="math inline">\(t\)</span> distribution become larger, the distribution becomes more and more similar to a normal. Here, using 4 degrees of freedom, we have a distribution that is somewhat normal, it is symmetrical and roughly bell-shaped, however it has “fat tails.” This presents itself clearly in the third panel. While many of the points are close to the line, at the edges, there are large discrepancies. This indicates that the values are to small (negative) or too large (positive) compared to what we would expect for a normal distribution. So for the sample size of <code>100</code>, we would conclude that that normality assumption is violated. (If these were residuals of a model.) For sample sizes of <code>10</code> and <code>25</code> we may be suspicious, but not entirely confident. Reading Q-Q plots, is a bit of an art, not completely a science.</p>
<p>Next, we simulate data from an exponential distribution.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))
<span class="kw">set.seed</span>(<span class="dv">420</span>)
<span class="kw">qq_plot</span>(<span class="kw">rexp</span>(<span class="dv">10</span>))
<span class="kw">qq_plot</span>(<span class="kw">rexp</span>(<span class="dv">25</span>))
<span class="kw">qq_plot</span>(<span class="kw">rexp</span>(<span class="dv">100</span>))</code></pre></div>
<p><img src="applied_statistics_files/figure-html/unnamed-chunk-320-1.png" width="768" /></p>
<p>This is a distribution that is not very similar to a normal, so in all three cases, we see points that are far from the lines, so we would think that the normality assumption is violated.</p>
<p>For a better understanding of which Q-Q plots are “good,” repeat the simulations above a number of times (without setting the seed) and pay attention to the differences between those that are simulated from normal, and those that are not. Also consider different samples sizes and distribution parameters.</p>
<p>Returning to our three regressions, recall,</p>
<ul>
<li><code>fit1</code> had no violation of assumptions,</li>
<li><code>fit2</code> violated the constant variance assumption, but not linearity,</li>
<li><code>fit3</code> violated linearity, but not constant variance.</li>
</ul>
<p>We’ll now create a Q-Q plot for each to asses normality of errors.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qqnorm</span>(<span class="kw">resid</span>(fit1), <span class="dt">main =</span> <span class="st">&quot;Normal Q-Q Plot, fit1&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;dodgerblue&quot;</span>)
<span class="kw">qqline</span>(<span class="kw">resid</span>(fit1), <span class="dt">col =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="applied_statistics_files/figure-html/unnamed-chunk-321-1.png" width="672" /></p>
<p>For <code>fit1</code>, we have a near perfect Q-Q plot. We would believe the errors follow a normal distribution.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qqnorm</span>(<span class="kw">resid</span>(fit2), <span class="dt">main =</span> <span class="st">&quot;Normal Q-Q Plot, fit2&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;dodgerblue&quot;</span>)
<span class="kw">qqline</span>(<span class="kw">resid</span>(fit2), <span class="dt">col =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="applied_statistics_files/figure-html/unnamed-chunk-322-1.png" width="672" /></p>
<p>For <code>fit2</code>, we have a suspect Q-Q plot. We would probably <strong>not</strong> believe the errors follow a normal distribution.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qqnorm</span>(<span class="kw">resid</span>(fit3), <span class="dt">main =</span> <span class="st">&quot;Normal Q-Q Plot, fit3&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;dodgerblue&quot;</span>)
<span class="kw">qqline</span>(<span class="kw">resid</span>(fit3), <span class="dt">col =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="applied_statistics_files/figure-html/unnamed-chunk-323-1.png" width="672" /></p>
<p>Lastly, for <code>fit3</code>, we again have a suspect Q-Q plot. We would probably <strong>not</strong> believe the errors follow a normal distribution.</p>
</div>
<div id="shapiro-wilk-test" class="section level3">
<h3><span class="header-section-number">7.2.5</span> Shapiro-Wilk Test</h3>
<p>Histograms and Q-Q Plots give a nice visual representation of the residuals distribution, however if we are interested in formal testing, there are a number of options available. A commonly used test is the <strong>Shapiro–Wilk test</strong>, which is implemented in <code>R</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">42</span>)
<span class="kw">shapiro.test</span>(<span class="kw">rnorm</span>(<span class="dv">25</span>))</code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  rnorm(25)
## W = 0.9499, p-value = 0.2495</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">shapiro.test</span>(<span class="kw">rexp</span>(<span class="dv">25</span>))</code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  rexp(25)
## W = 0.71164, p-value = 0.0000105</code></pre>
<p>This gives us the value of the test statistic and its p-value. The null hypothesis assumes the data follow a normal distribution, thus a small p-value indicates we believe there is only a small probability the data follow a normal distribution.</p>
<p>For details, see: <a href="https://en.wikipedia.org/wiki/Shapiro-Wilk_test">Wikipedia: Shapiro–Wilk test.</a></p>
<p>In the above examples, we see we fail to reject for the data sampled from normal, and reject on the non-normal data.</p>
<p>Returning again to <code>fit1</code>, <code>fit2</code> and <code>fit3</code>, we see the result of running <code>shapiro.test()</code> on the residuals of each, returns a result for each that matches for decisions based on the Q-Q plots.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">shapiro.test</span>(<span class="kw">resid</span>(fit1))</code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  resid(fit1)
## W = 0.99858, p-value = 0.9622</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">shapiro.test</span>(<span class="kw">resid</span>(fit2))</code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  resid(fit2)
## W = 0.94799, p-value = 3.002e-12</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">shapiro.test</span>(<span class="kw">resid</span>(fit3))</code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  resid(fit3)
## W = 0.97432, p-value = 0.000000109</code></pre>
</div>
</div>
<div id="unusual-observations" class="section level2">
<h2><span class="header-section-number">7.3</span> Unusual Observations</h2>
<p>In addition to checking the assumptions of regression, we also look for any “unusual observations” in the data. Often a small number of data points can have an extremely large influence on a regression, sometimes so much so that the regression assumptions are violated as a result of these points.</p>
<p>The following three plots are inspired by an example from <a href="http://www.maths.bath.ac.uk/~jjf23/LMR/">Linear Models with R</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))
<span class="kw">set.seed</span>(<span class="dv">42</span>)
ex_data  =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">1</span>:<span class="dv">10</span>, <span class="dt">y =</span> <span class="dv">10</span>:<span class="dv">1</span> +<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">10</span>))
ex_model =<span class="st"> </span><span class="kw">lm</span>(y ~<span class="st"> </span>x, <span class="dt">data =</span> ex_data)

<span class="co"># low leverage, yes outlier, small influence</span>
point1 =<span class="st"> </span><span class="kw">c</span>(<span class="fl">5.4</span>, <span class="dv">11</span>)
model1 =<span class="st"> </span><span class="kw">lm</span>(y ~<span class="st"> </span>x, <span class="dt">data =</span> <span class="kw">rbind</span>(ex_data, point1))
<span class="kw">plot</span>(y ~<span class="st"> </span>x, <span class="dt">data =</span> <span class="kw">rbind</span>(ex_data, point1), <span class="dt">cex =</span> <span class="fl">1.5</span>)
<span class="kw">points</span>(<span class="dt">x =</span> point1[<span class="dv">1</span>], <span class="dt">y =</span> point1[<span class="dv">2</span>], <span class="dt">pch =</span> <span class="dv">4</span>, <span class="dt">cex =</span> <span class="dv">5</span>, <span class="dt">col =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)
<span class="kw">abline</span>(ex_model, <span class="dt">col =</span> <span class="st">&quot;dodgerblue&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)
<span class="kw">abline</span>(model1, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)

<span class="co"># high leverage, not outlier, low influence</span>
point2 =<span class="st"> </span><span class="kw">c</span>(<span class="dv">15</span>, -<span class="fl">4.1</span>)
model2 =<span class="st"> </span><span class="kw">lm</span>(y ~<span class="st"> </span>x, <span class="dt">data =</span> <span class="kw">rbind</span>(ex_data, point2))
<span class="kw">plot</span>(y ~<span class="st"> </span>x, <span class="dt">data =</span> <span class="kw">rbind</span>(ex_data, point2), <span class="dt">cex =</span> <span class="fl">1.5</span>)
<span class="kw">points</span>(<span class="dt">x =</span> point2[<span class="dv">1</span>], <span class="dt">y =</span> point2[<span class="dv">2</span>], <span class="dt">pch =</span> <span class="dv">4</span>, <span class="dt">cex =</span> <span class="dv">5</span>, <span class="dt">col =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)
<span class="kw">abline</span>(ex_model, <span class="dt">col =</span> <span class="st">&quot;dodgerblue&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)
<span class="kw">abline</span>(model2, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)

<span class="co"># high leverage, yes outlier, large influence</span>
point3 =<span class="st"> </span><span class="kw">c</span>(<span class="dv">15</span>, <span class="fl">5.1</span>)
model3 =<span class="st"> </span><span class="kw">lm</span>(y ~<span class="st"> </span>x, <span class="dt">data =</span> <span class="kw">rbind</span>(ex_data, point3))
<span class="kw">plot</span>(y ~<span class="st"> </span>x, <span class="dt">data =</span> <span class="kw">rbind</span>(ex_data, point3), <span class="dt">cex =</span> <span class="fl">1.5</span>)
<span class="kw">points</span>(<span class="dt">x =</span> point3[<span class="dv">1</span>], <span class="dt">y =</span> point3[<span class="dv">2</span>], <span class="dt">pch =</span> <span class="dv">4</span>, <span class="dt">cex =</span> <span class="dv">5</span>, <span class="dt">col =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)
<span class="kw">abline</span>(ex_model, <span class="dt">col =</span> <span class="st">&quot;dodgerblue&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)
<span class="kw">abline</span>(model3, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="applied_statistics_files/figure-html/unnamed-chunk-328-1.png" width="672" /></p>
<p>The blue solid line in each plot is the regression fitted to the 10 original data points stored in <code>ex_data</code>. The dashed orange line in each plot is the result of adding a single point to the original data in <code>ex_data</code>. This additional point is indicated by the large red “X” in each plot.</p>
<p>The slope of the regression for the original ten points, the solid blue line, is given by:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coef</span>(ex_model)[<span class="dv">2</span>]</code></pre></div>
<pre><code>##          x 
## -0.9696033</code></pre>
<p>The added point in the first plot has a <em>small</em> effect on the slope, which becomes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coef</span>(model1)[<span class="dv">2</span>]</code></pre></div>
<pre><code>##          x 
## -0.9749534</code></pre>
<p>We will say that this point has low leverage, is an outlier due to its large residual, but has small influence.</p>
<p>The added point in the second plot also has a <em>small</em> effect on the slope, which is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coef</span>(model2)[<span class="dv">2</span>]</code></pre></div>
<pre><code>##         x 
## -1.018734</code></pre>
<p>We will say that this point has high leverage, is not an outlier due to its small residual, and has small influence.</p>
<p>Lastly, the added point in the third plot has a <em>large</em> effect on the slope, which is now:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coef</span>(model3)[<span class="dv">2</span>]</code></pre></div>
<pre><code>##          x 
## -0.5358609</code></pre>
<p>This added point is influential. It both has high leverage, and is an outlier due to its large residual.</p>
<p>We’ve now mentioned three new concepts: leverage, outliers, and influential points, each of which we will discuss in detail.</p>
<div id="leverage" class="section level3">
<h3><span class="header-section-number">7.3.1</span> Leverage</h3>
<p>A data point with high <strong>leverage</strong>, is a data point that <em>could</em> have a large influence when fitting the model.</p>
<p>Recall that,</p>
<p><span class="math display">\[
\hat{\beta} = \left(X^\top X \right)^{-1} X^\top y.
\]</span></p>
<p>Thus,</p>
<p><span class="math display">\[
\hat{y} = X \hat{\beta}   = X \left(X^\top X \right)^{-1} X^\top y
\]</span></p>
<p>Now we define,</p>
<p><span class="math display">\[
H = X \left(X^\top X\right)^{-1} X^\top
\]</span></p>
<p>which we will refer to as the <em>hat matrix</em>. The hat matrix is used to project onto the subspace spanned by the columns of <span class="math inline">\(X\)</span>. It is also simply known as a projection matrix.</p>
<p>The hat matrix, is a matrix that takes the original <span class="math inline">\(y\)</span> values, and adds a hat!</p>
<p><span class="math display">\[
\hat{y} = H y
\]</span></p>
<p>The diagonal elements of this matrix are called the <strong>leverages</strong></p>
<p><span class="math display">\[
H_{ii} = h_i,
\]</span></p>
<p>where <span class="math inline">\(h_i\)</span> is the leverage for the <span class="math inline">\(i\)</span>th observation.</p>
<p>Large values of <span class="math inline">\(h_i\)</span> indicate extreme values in <span class="math inline">\(X\)</span>, which may influence regression. Note that leverages only depend on <span class="math inline">\(X\)</span>.</p>
<p>Here, <span class="math inline">\(p\)</span> the number of <span class="math inline">\(\beta\)</span>s is also the trace (and rank) of the hat matrix.</p>
<p><span class="math display">\[
\sum_{i = 1}^n h_i = p
\]</span></p>
<p>What is a value of <span class="math inline">\(h_i\)</span> that would be considered large? There is no exact answer to this question. A common heuristic would be to compare each leverage to two times the average leverage. A leverage larger than this is considered an observation to be aware of. That is, if</p>
<p><span class="math display">\[
h_i &gt; 2 \bar{h}
\]</span></p>
<p>we say that observation <span class="math inline">\(i\)</span> has large leverage. Here,</p>
<p><span class="math display">\[
\bar{h} = \frac{\sum_{i = 1}^n h_i}{n} = \frac{p}{n}.
\]</span></p>
<p>For simple linear regression, the leverage for each point is given by</p>
<p><span class="math display">\[
h_i = \frac{1}{n} + \frac{(x_i - \bar{x})^2}{S_{xx}}.
\]</span></p>
<p>This expression should be familiar. (Think back to inference for SLR.) It suggests that the large leverages occur when <span class="math inline">\(x\)</span> values are far from their mean. Recall that the regression goes through the point <span class="math inline">\((\bar{x},\bar{y})\)</span>.</p>
<p>There are multiple ways to find leverages in <code>R</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lev_ex =<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">x1 =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">11</span>, <span class="dv">11</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">10</span>, <span class="dv">5</span>, <span class="dv">8</span>),
  <span class="dt">x2 =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>),
  <span class="dt">y  =</span> <span class="kw">c</span>(<span class="dv">11</span>, <span class="dv">15</span>, <span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">0</span>, <span class="dv">19</span>, <span class="dv">16</span>, <span class="dv">8</span>))

<span class="kw">plot</span>(x2 ~<span class="st"> </span>x1, <span class="dt">data =</span> lev_ex, <span class="dt">cex =</span> <span class="dv">2</span>)
<span class="kw">points</span>(<span class="dv">7</span>, <span class="dv">3</span>, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">cex =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="applied_statistics_files/figure-html/unnamed-chunk-333-1.png" width="672" /></p>
<p>Here we’ve created some multivariate data. Notice that we have plotted the <span class="math inline">\(x\)</span> values, not the <span class="math inline">\(y\)</span> values. The red point is <span class="math inline">\((7, 3)\)</span> which is the mean of <code>x1</code> and the mean of <code>x2</code> respectively.</p>
<p>We could calculate the leverages using the expressions defined above. We first create the <span class="math inline">\(X\)</span> matrix, then calculate <span class="math inline">\(H\)</span> as defined, and extract the diagonal elements.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">X =<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">8</span>), lev_ex$x1, lev_ex$x2)
H =<span class="st"> </span>X %*%<span class="st"> </span><span class="kw">solve</span>(<span class="kw">t</span>(X) %*%<span class="st"> </span>X) %*%<span class="st"> </span><span class="kw">t</span>(X)
<span class="kw">diag</span>(H)</code></pre></div>
<pre><code>## [1] 0.6000 0.3750 0.2875 0.1250 0.4000 0.2125 0.5875 0.4125</code></pre>
<p>Notice here, we have two predictors, so the regression would have 3 <span class="math inline">\(\beta\)</span> parameters, so the sum of the diagonal elements is 3.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(<span class="kw">diag</span>(H))</code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>Alternatively, the method we will use more often, is to simply fit a regression, then use the <code>hatvalues()</code> function, which returns the leverages.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lev_fit =<span class="st"> </span><span class="kw">lm</span>(y ~<span class="st"> </span>., <span class="dt">data =</span> lev_ex)
<span class="kw">hatvalues</span>(lev_fit)</code></pre></div>
<pre><code>##      1      2      3      4      5      6      7      8 
## 0.6000 0.3750 0.2875 0.1250 0.4000 0.2125 0.5875 0.4125</code></pre>
<p>Again, note that here we have “used” the <span class="math inline">\(y\)</span> values to fit the regression, but <code>R</code> still ignores them when calculating the leverages, as leverages only depend on the <span class="math inline">\(x\)</span> values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coef</span>(lev_fit)</code></pre></div>
<pre><code>## (Intercept)          x1          x2 
##         3.7        -0.7         4.4</code></pre>
<p>Let’s see what happens to these coefficients when we modify the <code>y</code> value of the point with the highest leverage.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">which.max</span>(<span class="kw">hatvalues</span>(lev_fit))</code></pre></div>
<pre><code>## 1 
## 1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lev_ex[<span class="kw">which.max</span>(<span class="kw">hatvalues</span>(lev_fit)),]</code></pre></div>
<pre><code>##   x1 x2  y
## 1  0  1 11</code></pre>
<p>We see that the original <code>y</code> value is 11. We’ll create a copy of the data, and modify this point to have a <code>y</code> value of <code>20</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lev_ex_1 =<span class="st"> </span>lev_ex
lev_ex_1$y[<span class="dv">1</span>] =<span class="st"> </span><span class="dv">20</span>
<span class="kw">lm</span>(y ~<span class="st"> </span>., <span class="dt">data =</span> lev_ex_1)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ ., data = lev_ex_1)
## 
## Coefficients:
## (Intercept)           x1           x2  
##       8.875       -1.375        4.625</code></pre>
<p>Notice the <strong>large</strong> changes in the coefficients. Also notice that each of the coefficients has changed in some way. Note that the leverages of the points would not have changed, as we have not modified any of the <span class="math inline">\(x\)</span> values.</p>
<p>Now let’s see what happens to these coefficients when we modify the <code>y</code> value of the point with the lowest leverage.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">which.min</span>(<span class="kw">hatvalues</span>(lev_fit))</code></pre></div>
<pre><code>## 4 
## 4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lev_ex[<span class="kw">which.min</span>(<span class="kw">hatvalues</span>(lev_fit)),]</code></pre></div>
<pre><code>##   x1 x2  y
## 4  7  3 14</code></pre>
<p>We see that the original <code>y</code> value is 14. We’ll again create a copy of the data, and modify this point to have a <code>y</code> value of <code>30</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lev_ex_2 =<span class="st"> </span>lev_ex
lev_ex_2$y[<span class="dv">4</span>] =<span class="st"> </span><span class="dv">30</span>
<span class="kw">lm</span>(y ~<span class="st"> </span>., <span class="dt">data =</span> lev_ex_2)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ ., data = lev_ex_2)
## 
## Coefficients:
## (Intercept)           x1           x2  
##         5.7         -0.7          4.4</code></pre>
<p>This time despite a large change in the <code>y</code> value, there is only small change in the coefficients. Also, only the intercept has changed!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(lev_ex$x1)</code></pre></div>
<pre><code>## [1] 7</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(lev_ex$x2)</code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lev_ex[<span class="dv">4</span>,]</code></pre></div>
<pre><code>##   x1 x2  y
## 4  7  3 14</code></pre>
<p>Notice that this point was the mean of both of the predictors.</p>
<p>Returning to our three plots, each with an added point, we can calculate the leverages for each. Note that the 11th data point each time is the added data point.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hatvalues</span>(model1)</code></pre></div>
<pre><code>##          1          2          3          4          5          6          7 
## 0.33534597 0.23860732 0.16610842 0.11784927 0.09382988 0.09405024 0.11851036 
##          8          9         10         11 
## 0.16721022 0.24014985 0.33732922 0.09100926</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hatvalues</span>(model2)</code></pre></div>
<pre><code>##          1          2          3          4          5          6          7 
## 0.26574586 0.20662983 0.15966851 0.12486188 0.10220994 0.09171271 0.09337017 
##          8          9         10         11 
## 0.10718232 0.13314917 0.17127072 0.54419890</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hatvalues</span>(model3)</code></pre></div>
<pre><code>##          1          2          3          4          5          6          7 
## 0.26574586 0.20662983 0.15966851 0.12486188 0.10220994 0.09171271 0.09337017 
##          8          9         10         11 
## 0.10718232 0.13314917 0.17127072 0.54419890</code></pre>
<p>Are any of these large?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hatvalues</span>(model1) &gt;<span class="st"> </span><span class="dv">2</span> *<span class="st"> </span><span class="kw">mean</span>(<span class="kw">hatvalues</span>(model1))</code></pre></div>
<pre><code>##     1     2     3     4     5     6     7     8     9    10    11 
## FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hatvalues</span>(model2) &gt;<span class="st"> </span><span class="dv">2</span> *<span class="st"> </span><span class="kw">mean</span>(<span class="kw">hatvalues</span>(model2))</code></pre></div>
<pre><code>##     1     2     3     4     5     6     7     8     9    10    11 
## FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hatvalues</span>(model3) &gt;<span class="st"> </span><span class="dv">2</span> *<span class="st"> </span><span class="kw">mean</span>(<span class="kw">hatvalues</span>(model3))</code></pre></div>
<pre><code>##     1     2     3     4     5     6     7     8     9    10    11 
## FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE</code></pre>
<p>We see that in the second and third plots, the added point is a point of high leverage. Recall that only in the third plot did that have an influence on the regression. To understand why, we’ll need to discuss outliers.</p>
</div>
<div id="outliers" class="section level3">
<h3><span class="header-section-number">7.3.2</span> Outliers</h3>
<p>Outliers are points which do not fit the model well. They may or may not have a large affect on the model. To identify outliers, we will look for observations with large residuals.</p>
<p>Note,</p>
<p><span class="math display">\[
e = y - \hat{y} = Iy - Hy = (I - H) y
\]</span></p>
<p>Then, under the assumptions of linear regression,</p>
<p><span class="math display">\[
Var(e_i) = (1 - h_i) \sigma^2
\]</span></p>
<p>and thus estimating <span class="math inline">\(\sigma^2\)</span> with <span class="math inline">\(s_e^2\)</span> gives</p>
<p><span class="math display">\[
SE[e_i] = s_e \sqrt{(1 - h_i)}.
\]</span></p>
<p>We can then look at the <strong>standardized residual</strong> for each observation, <span class="math inline">\(i = 1, 2, \ldots n\)</span>,</p>
<p><span class="math display">\[
r_i = \frac{e_i}{s_e\sqrt{1 - h_i}} \overset{approx}{\sim} N(\mu = 0, \sigma^ 2 = 1)
\]</span></p>
<p>when <span class="math inline">\(n\)</span> is large.</p>
<p>We can use this fact to identify “large” residuals. For example, standardized residuals greater than 2 in magnitude should only happen approximately 5 percent of the time.</p>
<p>Returning again to our three plots, each with an added point, we can calculate the residuals and standardized residuals for each. Standardized residuals can be obtained in <code>R</code> by using <code>rstandard()</code> where we would normally use <code>resid()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">resid</span>(model1)</code></pre></div>
<pre><code>##          1          2          3          4          5          6          7 
##  0.4949887 -1.4657145 -0.5629345 -0.3182468 -0.5718877 -1.1073271  0.4852728 
##          8          9         10         11 
## -1.1459548  0.9420814 -1.1641029  4.4138254</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rstandard</span>(model1)</code></pre></div>
<pre><code>##          1          2          3          4          5          6          7 
##  0.3464701 -0.9585470 -0.3517802 -0.1933575 -0.3428264 -0.6638841  0.2949482 
##          8          9         10         11 
## -0.7165857  0.6167268 -0.8160389  2.6418234</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rstandard</span>(model1)[<span class="kw">abs</span>(<span class="kw">rstandard</span>(model1)) &gt;<span class="st"> </span><span class="dv">2</span>]</code></pre></div>
<pre><code>##       11 
## 2.641823</code></pre>
<p>In the first plot, we see that the 11th point, the added point, is a large standardized residual.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">resid</span>(model2)</code></pre></div>
<pre><code>##          1          2          3          4          5          6          7 
##  0.7820254 -1.1348974 -0.1883370  0.1001310 -0.1097294 -0.6013884  1.0349919 
##          8          9         10         11 
## -0.5524553  1.5793613 -0.4830427 -0.4266595</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rstandard</span>(model2)</code></pre></div>
<pre><code>##          1          2          3          4          5          6          7 
##  1.0653318 -1.4873251 -0.2398267  0.1249447 -0.1351833 -0.7365982  1.2688468 
##          8          9         10         11 
## -0.6825005  1.9801429 -0.6193932 -0.7377020</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rstandard</span>(model2)[<span class="kw">abs</span>(<span class="kw">rstandard</span>(model2)) &gt;<span class="st"> </span><span class="dv">2</span>]</code></pre></div>
<pre><code>## named numeric(0)</code></pre>
<p>In the second plot, we see that there are no points with large standardized residuals.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">resid</span>(model3)</code></pre></div>
<pre><code>##          1          2          3          4          5          6          7 
##  2.5356166  0.1358208  0.5995083  0.4051034 -0.2876300 -1.2621619 -0.1086545 
##          8          9         10         11 
## -2.1789746 -0.5300310 -3.0753079  3.7667107</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rstandard</span>(model3)</code></pre></div>
<pre><code>##           1           2           3           4           5           6 
##  1.45289045  0.07486882  0.32110154  0.21261803 -0.14904562 -0.65024338 
##           7           8           9          10          11 
## -0.05602801 -1.13225246 -0.27951271 -1.65865000  2.73934714</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rstandard</span>(model3)[<span class="kw">abs</span>(<span class="kw">rstandard</span>(model3)) &gt;<span class="st"> </span><span class="dv">2</span>]</code></pre></div>
<pre><code>##       11 
## 2.739347</code></pre>
<p>In the last plot, we see that the 11th point, the added point, is a large standardized residual.</p>
<p>Recall that the added point in plots two and three were both high leverage, but now only the point in plot three has a large residual. We will now combine this information and discuss influence.</p>
</div>
<div id="influence" class="section level3">
<h3><span class="header-section-number">7.3.3</span> Influence</h3>
<p>As we have now seen in the three plots, some outliers only change the regression a small amount (plot one) and some outliers have a large effect on the regression (plot three). Observations that fall into the later category, points of <em>high leverage</em> <strong>and</strong> <em>large residual</em>, we will call <strong>influential</strong>.</p>
<p>A common measure of influence is <strong>Cook’s Distance</strong>, which is defined as</p>
<p><span class="math display">\[
  D_i = \frac{1}{p}r_i^2\frac{h_i}{1-{h_i}}.
\]</span></p>
<p>Notice that this is a function of both <em>leverage</em> and <em>standardized residuals</em>.</p>
<p>A Cook’s Distance is considered large if</p>
<p><span class="math display">\[
D_i &gt; \frac{4}{n}
\]</span></p>
<p>and an observation with a large Cook’s Distance is called influential. This is again simply a heuristic, and not an exact rule.</p>
<p>The Cook’s distance for each point of a regression can be calculated using <code>cooks.distance()</code> which is a default function in <code>R</code>. Let’s look for influential points in the three plots we had been considering.</p>
<p><img src="applied_statistics_files/figure-html/unnamed-chunk-348-1.png" width="672" /></p>
<p>Recall that the added points (large red “X”) in each plot have different characteristics:</p>
<ul>
<li>Plot One: low leverage, large residual.</li>
<li>Plot Two: high leverage, small residual.</li>
<li>Plot Three: high leverage, large residual.</li>
</ul>
<p>We’ll now directly check if each of these is influential.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cooks.distance</span>(model1)[<span class="dv">11</span>] &gt;<span class="st"> </span><span class="dv">4</span> /<span class="st"> </span><span class="kw">length</span>(<span class="kw">cooks.distance</span>(model1))</code></pre></div>
<pre><code>##    11 
## FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cooks.distance</span>(model2)[<span class="dv">11</span>] &gt;<span class="st"> </span><span class="dv">4</span> /<span class="st"> </span><span class="kw">length</span>(<span class="kw">cooks.distance</span>(model2))</code></pre></div>
<pre><code>##    11 
## FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cooks.distance</span>(model3)[<span class="dv">11</span>] &gt;<span class="st"> </span><span class="dv">4</span> /<span class="st"> </span><span class="kw">length</span>(<span class="kw">cooks.distance</span>(model3))</code></pre></div>
<pre><code>##   11 
## TRUE</code></pre>
<p>And, as expected, the added point in the third plot, with high leverage and a large residual is considered influential!</p>
</div>
</div>
<div id="data-analysis-examples" class="section level2">
<h2><span class="header-section-number">7.4</span> Data Analysis Examples</h2>
<div id="good-diagnostics" class="section level3">
<h3><span class="header-section-number">7.4.1</span> Good Diagnostics</h3>
<p>Last chapter we fit an additive regression to the <code>mtcars</code> data with <code>mpg</code> as the response and <code>hp</code> and <code>am</code> as predictors. Let’s perform some diagnostics on this model.</p>
<p>First, fit the model as we did last chapter.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mpg_hp_add =<span class="st"> </span><span class="kw">lm</span>(mpg ~<span class="st"> </span>hp +<span class="st"> </span>am, <span class="dt">data =</span> mtcars)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">fitted</span>(mpg_hp_add), <span class="kw">resid</span>(mpg_hp_add), <span class="dt">col =</span> <span class="st">&quot;dodgerblue&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;Fitted&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Residual&quot;</span>)
<span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>, <span class="dt">col =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="applied_statistics_files/figure-html/unnamed-chunk-351-1.png" width="672" /></p>
<p>The fitted versus residuals plot looks good. We don’t see any obvious pattern, and the variance looks roughly constant. (Maybe a little larger for large fitted values, but not enough to worry about.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">bptest</span>(mpg_hp_add)</code></pre></div>
<pre><code>## 
##  studentized Breusch-Pagan test
## 
## data:  mpg_hp_add
## BP = 7.5858, df = 2, p-value = 0.02253</code></pre>
<p>The Breusch-Pagan test verifies this, at least for a small <span class="math inline">\(\alpha\)</span> value.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qqnorm</span>(<span class="kw">resid</span>(mpg_hp_add), <span class="dt">col =</span> <span class="st">&quot;dodgerblue&quot;</span>)
<span class="kw">qqline</span>(<span class="kw">resid</span>(mpg_hp_add), <span class="dt">col =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="applied_statistics_files/figure-html/unnamed-chunk-353-1.png" width="672" /></p>
<p>The Q-Q plot looks extremely good and the Shapiro-Wilk test agrees.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">shapiro.test</span>(<span class="kw">resid</span>(mpg_hp_add))</code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  resid(mpg_hp_add)
## W = 0.96485, p-value = 0.3706</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(<span class="kw">hatvalues</span>(mpg_hp_add) &gt;<span class="st"> </span><span class="dv">2</span> *<span class="st"> </span><span class="kw">mean</span>(<span class="kw">hatvalues</span>(mpg_hp_add)))</code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>We see that there are two points of large leverage.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(<span class="kw">abs</span>(<span class="kw">rstandard</span>(mpg_hp_add)) &gt;<span class="st"> </span><span class="dv">2</span>)</code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>There is also one point with a large residual. Do these result in any points that are considered influential?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cd_mpg_hp_add =<span class="st"> </span><span class="kw">cooks.distance</span>(mpg_hp_add)
<span class="kw">sum</span>(cd_mpg_hp_add &gt;<span class="st"> </span><span class="dv">4</span> /<span class="st"> </span><span class="kw">length</span>(cd_mpg_hp_add))</code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">large_cd_mpg =<span class="st"> </span>cd_mpg_hp_add &gt;<span class="st"> </span><span class="dv">4</span> /<span class="st"> </span><span class="kw">length</span>(cd_mpg_hp_add)
cd_mpg_hp_add[large_cd_mpg]</code></pre></div>
<pre><code>## Toyota Corolla  Maserati Bora 
##      0.1772555      0.3447994</code></pre>
<p>We find two influential points. Interestingly, they are <strong>very</strong> different cars.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coef</span>(mpg_hp_add)</code></pre></div>
<pre><code>## (Intercept)          hp          am 
##  26.5849137  -0.0588878   5.2770853</code></pre>
<p>Since the diagnostics looked good, there isn’t much need to worry about these two points, but let’s see how much the coefficients change if we remove them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mpg_hp_add_fix =<span class="st"> </span><span class="kw">lm</span>(mpg ~<span class="st"> </span>hp +<span class="st"> </span>am, <span class="dt">data =</span> mtcars, <span class="dt">subset =</span> cd_mpg_hp_add &lt;=<span class="st"> </span><span class="dv">4</span> /<span class="st"> </span><span class="kw">length</span>(cd_mpg_hp_add))
<span class="kw">coef</span>(mpg_hp_add_fix)</code></pre></div>
<pre><code>## (Intercept)          hp          am 
## 27.22190933 -0.06286249  4.29765867</code></pre>
<p>It seems there isn’t much of a change in the coefficients as a results of removing the supposed influential points. Notice we did not create a new dataset to accomplish this. We instead used the <code>subset</code> argument to <code>lm()</code>. Think about what the code <code>cd_mpg_hp_add &lt;= 4 / length(cd_mpg_hp_add)</code> does here.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))
<span class="kw">plot</span>(mpg_hp_add)</code></pre></div>
<p><img src="applied_statistics_files/figure-html/unnamed-chunk-360-1.png" width="768" /></p>
<p>Notice that, calling <code>plot()</code> on a variable which stores an object created by <code>lm()</code> outputs four diagnostic plots by default. Use <code>?plot.lm</code> to learn more. The first two should already be familiar.</p>
</div>
<div id="suspect-diagnostics" class="section level3">
<h3><span class="header-section-number">7.4.2</span> Suspect Diagnostics</h3>
<p>Let’s consider the model <code>big_model</code> from last chapter which was fit to the <code>autompg</code> dataset. It used <code>mpg</code> as the response, and considered many interaction terms between the predictors <code>disp</code>, <code>hp</code>, and <code>domestic</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(autompg)</code></pre></div>
<pre><code>## &#39;data.frame&#39;:    383 obs. of  9 variables:
##  $ mpg     : num  18 15 18 16 17 15 14 14 14 15 ...
##  $ cyl     : Factor w/ 3 levels &quot;4&quot;,&quot;6&quot;,&quot;8&quot;: 3 3 3 3 3 3 3 3 3 3 ...
##  $ disp    : num  307 350 318 304 302 429 454 440 455 390 ...
##  $ hp      : num  130 165 150 150 140 198 220 215 225 190 ...
##  $ wt      : num  3504 3693 3436 3433 3449 ...
##  $ acc     : num  12 11.5 11 12 10.5 10 9 8.5 10 8.5 ...
##  $ year    : int  70 70 70 70 70 70 70 70 70 70 ...
##  $ origin  : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ domestic: num  1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">big_model =<span class="st"> </span><span class="kw">lm</span>(mpg ~<span class="st"> </span>disp *<span class="st"> </span>hp *<span class="st"> </span>domestic, <span class="dt">data =</span> autompg)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qqnorm</span>(<span class="kw">resid</span>(big_model), <span class="dt">col =</span> <span class="st">&quot;dodgerblue&quot;</span>)
<span class="kw">qqline</span>(<span class="kw">resid</span>(big_model), <span class="dt">col =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="applied_statistics_files/figure-html/unnamed-chunk-364-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">shapiro.test</span>(<span class="kw">resid</span>(big_model))</code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  resid(big_model)
## W = 0.96161, p-value = 0.00000001824</code></pre>
<p>Here both the Q-Q plot, and the Shapiro-Wilk test suggest that the normality assumption is violated.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">big_mod_cd =<span class="st"> </span><span class="kw">cooks.distance</span>(big_model)
<span class="kw">sum</span>(big_mod_cd &gt;<span class="st"> </span><span class="dv">4</span> /<span class="st"> </span><span class="kw">length</span>(big_mod_cd))</code></pre></div>
<pre><code>## [1] 31</code></pre>
<p>Here, we find 31, so perhaps removing them will help!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">big_model_fix =<span class="st"> </span><span class="kw">lm</span>(mpg ~<span class="st"> </span>disp *<span class="st"> </span>hp *<span class="st"> </span>domestic, <span class="dt">data =</span> autompg, <span class="dt">subset =</span> big_mod_cd &lt;<span class="st"> </span><span class="dv">4</span> /<span class="st"> </span><span class="kw">length</span>(big_mod_cd))
<span class="kw">qqnorm</span>(<span class="kw">resid</span>(big_model_fix), <span class="dt">col =</span> <span class="st">&quot;dodgerblue&quot;</span>)
<span class="kw">qqline</span>(<span class="kw">resid</span>(big_model_fix), <span class="dt">col =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="applied_statistics_files/figure-html/unnamed-chunk-366-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">shapiro.test</span>(<span class="kw">resid</span>(big_model_fix))</code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  resid(big_model_fix)
## W = 0.99035, p-value = 0.02068</code></pre>
<p>Removing these points results in a much better Q-Q plot, and now Shapiro-Wilk fails to reject for a low <span class="math inline">\(\alpha\)</span>.</p>
<p>We’ve now seen that sometimes modifying the data can fix issues with regression. However, next chapter, instead of modifying the data, we will modify the model via <em>transformations</em>.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="categorical-predictors-and-interactions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="transformations.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/daviddalpiaz/appliedstats/edit/master/06-diagnostics.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
