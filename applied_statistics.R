## ----setup, echo=FALSE, message=FALSE, warning=FALSE--------------------------
require(knitr)
read_chunk('r_book.R')
options(scipen = 8, width = 80)
knit_hooks$set(purl = hook_purl)
opts_template$set(nopurl = list(purl = FALSE))
opts_template$set(dopurl = list(purl = TRUE))

## ----load_packages, message=FALSE,echo=FALSE, warning=FALSE-------------------
# Any package that is required by the script below is given here:
inst_pkgs = load_pkgs =  c("ggplot2","devtools","zoo")
inst_pkgs = inst_pkgs[!(inst_pkgs %in% installed.packages()[,"Package"])]
if(length(inst_pkgs)) install.packages(inst_pkgs)

# Dynamically load packages
pkgs_loaded = lapply(load_pkgs, require, character.only = TRUE)

## ----misc_func, echo=FALSE----------------------------------------------------

## ---- eval = FALSE------------------------------------------------------------
#  a = 3
#  b = 4
#  sqrt(a ^ 2 + b ^ 2)

## ---- echo = FALSE, eval = TRUE-----------------------------------------------
a = 3
b = 4
sqrt(a ^ 2 + b ^ 2)

## -----------------------------------------------------------------------------
3 + 2
3 - 2
3 * 2
3 / 2

## -----------------------------------------------------------------------------
3 ^ 2
2 ^ (-3)
100 ^ (1 / 2)
sqrt(1 / 2)
exp(1)

## -----------------------------------------------------------------------------
pi
exp(1)

## -----------------------------------------------------------------------------
log(10)           # natural log
log10(1000)       # base 10 log
log2(8)           # base 2 log
log(16, base = 4) # base 4 log

## -----------------------------------------------------------------------------
sin(pi / 2)
cos(0)

## ---- eval = FALSE------------------------------------------------------------
#  ?log
#  ?sin
#  ?paste
#  ?lm

## ---- eval = FALSE------------------------------------------------------------
#  install.packages("ggplot2")

## ---- eval = FALSE------------------------------------------------------------
#  library(ggplot2)

## -----------------------------------------------------------------------------
c(1, 3, 5, 7, 8, 9)

## -----------------------------------------------------------------------------
x = c(1, 3, 5, 7, 8, 9)
x

## -----------------------------------------------------------------------------
(y = 1:100)

## -----------------------------------------------------------------------------
x
x[1]
x[3]

## -----------------------------------------------------------------------------
x[-2]

## -----------------------------------------------------------------------------
x[1:3]
x[c(1,3,4)]

## -----------------------------------------------------------------------------
x = 1:10

## -----------------------------------------------------------------------------
x + 1
2 * x
2 ^ x
sqrt(x)
log(x)

## -----------------------------------------------------------------------------
vec_1 = 1:10
vec_2 = 1:1000
vec_3 = 42

## -----------------------------------------------------------------------------
length(vec_1)
length(vec_2)
length(vec_3)

## -----------------------------------------------------------------------------
seq(from = 1.5, to = 4.2, by = 0.1)

## -----------------------------------------------------------------------------
seq(1.5, 4.2, 0.1)

## -----------------------------------------------------------------------------
rep(0.5, times = 10)

## -----------------------------------------------------------------------------
rep(x, times = 3)

## -----------------------------------------------------------------------------
c(x, rep(seq(1, 9, 2), 3), c(1, 2, 3), 42, 2:4)

## -----------------------------------------------------------------------------
y

## -----------------------------------------------------------------------------
mean(y)
median(y)

## -----------------------------------------------------------------------------
var(y)
sd(y)
IQR(y)
min(y)
max(y)
range(y)

## -----------------------------------------------------------------------------
x = 1:9
x
X = matrix(x, nrow = 3, ncol = 3)
X

## -----------------------------------------------------------------------------
Y = matrix(x, nrow = 3, ncol = 3, byrow = TRUE)
Y

## -----------------------------------------------------------------------------
Z = matrix(0, 2, 4)
Z

## -----------------------------------------------------------------------------
X
X[1, 2]

## -----------------------------------------------------------------------------
X[1, ]
X[, 2]

## -----------------------------------------------------------------------------
X[2, c(1, 3)]

## -----------------------------------------------------------------------------
x = 1:9
rev(x)
rep(1, 9)

## -----------------------------------------------------------------------------
cbind(x, rev(x), rep(1, 9))

## -----------------------------------------------------------------------------
rbind(x, rev(x), rep(1, 9))

## -----------------------------------------------------------------------------
x = 1:9
y = 9:1
X = matrix(x, 3, 3)
Y = matrix(y, 3, 3)
X
Y

## -----------------------------------------------------------------------------
X + Y
X - Y
X * Y
X / Y

## -----------------------------------------------------------------------------
X %*% Y
t(X)

## -----------------------------------------------------------------------------
Z = matrix(c(9, 2, -3, 2, 4, -2, -3, -2, 16), 3, byrow = TRUE)
Z
solve(Z)

## -----------------------------------------------------------------------------
X = matrix(1:6, 2, 3)
X
dim(X)
rowSums(X)
colSums(X)
rowMeans(X)
colMeans(X)

## -----------------------------------------------------------------------------
diag(Z)

## -----------------------------------------------------------------------------
diag(1:5)

## -----------------------------------------------------------------------------
diag(5)

## -----------------------------------------------------------------------------
example_data = data.frame(x = c(1, 3, 5, 7, 9, 1, 3, 5, 7, 9),
                          y = rep("Hello", 10),
                          z = rep(c("TRUE", "FALSE"), 5))

## -----------------------------------------------------------------------------
example_data

## ---- echo = FALSE------------------------------------------------------------
write.csv(example_data, "data/example_data.csv", row.names = FALSE)

## ---- eval = FALSE------------------------------------------------------------
#  example_data_from_csv = read.csv("data/example_data.csv")

## ---- eval = FALSE------------------------------------------------------------
#  library(ggplot2)

## -----------------------------------------------------------------------------
head(mpg, n = 10)

## -----------------------------------------------------------------------------
str(mpg)

## ---- eval = FALSE------------------------------------------------------------
#  ?mpg

## -----------------------------------------------------------------------------
names(mpg)

## -----------------------------------------------------------------------------
mpg$year
mpg$hwy

## -----------------------------------------------------------------------------
dim(mpg)
nrow(mpg)
ncol(mpg)

## -----------------------------------------------------------------------------
hist(mpg$cty)

## -----------------------------------------------------------------------------
hist(mpg$cty,
     xlab   = "Miles Per Gallon (City)",
     main   = "Histogram of MPG (City)",
     breaks = 12,
     col    = "dodgerblue",
     border = "darkorange")

## -----------------------------------------------------------------------------
unique(mpg$drv)

## -----------------------------------------------------------------------------
boxplot(hwy ~ drv, data = mpg)

## -----------------------------------------------------------------------------
boxplot(hwy ~ drv, data = mpg,
     xlab   = "Drivetrain (f = FWD, r = RWD, 4 = 4WD)",
     ylab   = "Miles Per Gallon (Highway)",
     main   = "MPG (Highway) vs Drivetrain",
     pch    = 20,
     cex    = 2,
     col    = "darkorange",
     border = "dodgerblue")

## -----------------------------------------------------------------------------
plot(hwy ~ displ, data = mpg)

## -----------------------------------------------------------------------------
plot(hwy ~ displ, data = mpg,
     xlab = "Engine Displacement (in Liters)",
     ylab = "Miles Per Gallon (Highway)",
     main = "MPG (Highway) vs Engine Displacement",
     pch  = 20,
     cex  = 2,
     col  = "dodgerblue")

## -----------------------------------------------------------------------------
dnorm(x = 3, mean = 2, sd = 5)

## -----------------------------------------------------------------------------
pnorm(q = 3, mean = 2, sd = 5)

## -----------------------------------------------------------------------------
qnorm(p = 0.975, mean = 2, sd = 5)

## -----------------------------------------------------------------------------
rnorm(n = 10, mean = 2, sd = 5)

## -----------------------------------------------------------------------------
dbinom(x = 6, size = 10, prob = 0.75)

## -----------------------------------------------------------------------------
heights = c(110, 120, 115, 136, 205, 156, 175)
weights = c(64, 67, 62, 60, 77, 70, 66)

## -----------------------------------------------------------------------------
heights < 121
heights < 121 | heights == 156

## -----------------------------------------------------------------------------
heights > 150
heights[heights > 150]
weights[heights > 150]

## -----------------------------------------------------------------------------
a = 1:10
b = 2:4
a < b

## -----------------------------------------------------------------------------
a > 5

## -----------------------------------------------------------------------------
1 * (a > 5)

## -----------------------------------------------------------------------------
sum(1 * (a > 5))

## ---- eval = FALSE------------------------------------------------------------
#  if (...) {
#    some R code
#  } else {
#    more R code
#  }

## -----------------------------------------------------------------------------
x = 1
y = 3
if (x > y) {
  z = x * y
  print("x is larger than y")
} else {
  z = x + 5 * y
  print("x is less than or equal to y")
}

z

## -----------------------------------------------------------------------------
ifelse(4 > 3, 1, 0)

## -----------------------------------------------------------------------------
fib = c(1, 1, 2, 3, 5, 8, 13, 21)
ifelse(fib > 6, "Foo", "Bar")

## -----------------------------------------------------------------------------
x = 11:15
for (i in 1:5) {
  x[i] = x[i] * 2
}

x

## -----------------------------------------------------------------------------
x = 11:15
x = x * 2
x

## -----------------------------------------------------------------------------
standardize = function(x) {
  m = mean(x)
  std = sd(x)
  result = (x - m) / std
  result
}

## -----------------------------------------------------------------------------
set.seed(42)
(test_sample = rnorm(n = 10, mean = 2, sd = 5))
standardize(x = test_sample)

## -----------------------------------------------------------------------------
result = standardize(x = test_sample)
mean(result)
sd(result)

## -----------------------------------------------------------------------------
standardize = function(x) {
  (x - mean(x)) / sd(x)
}

## -----------------------------------------------------------------------------
get_sd = function(x, biased = FALSE) {
  n = length(x) - 1 * !biased
  sqrt((1 / n) * sum((x - mean(x)) ^ 2))
}

## -----------------------------------------------------------------------------
get_sd(test_sample)
get_sd(test_sample, biased = FALSE)
sd(test_sample)
get_sd(test_sample, biased = TRUE)

## -----------------------------------------------------------------------------
capt_crisp = data.frame(weight = c(15.5, 16.2, 16.1, 15.8, 15.6, 16.0, 15.8, 15.9, 16.2))

## -----------------------------------------------------------------------------
x_bar = mean(capt_crisp$weight)
s     = sd(capt_crisp$weight)
mu_0  = 16
n     = 9

## -----------------------------------------------------------------------------
t = (x_bar - mu_0) / (s / sqrt(n))
t

## -----------------------------------------------------------------------------
pt(t, df = n - 1)

## -----------------------------------------------------------------------------
t.test(capt_crisp$weight, mu = 16, alternative = c("less"), conf.level = 0.95)

## -----------------------------------------------------------------------------
capt_test_results = t.test(capt_crisp$weight, mu = 16,
                           alternative = c("two.sided"), conf.level = 0.95)

## -----------------------------------------------------------------------------
names(capt_test_results)

## -----------------------------------------------------------------------------
capt_test_results$conf.int

## -----------------------------------------------------------------------------
qt(0.975, df = 8)

## -----------------------------------------------------------------------------
c(mean(capt_crisp$weight) - qt(0.975, df = 8) * sd(capt_crisp$weight) / sqrt(9),
  mean(capt_crisp$weight) + qt(0.975, df = 8) * sd(capt_crisp$weight) / sqrt(9))

## -----------------------------------------------------------------------------
x = c(70, 82, 78, 74, 94, 82)
n = length(x)

## -----------------------------------------------------------------------------
y = c(64, 72, 60, 76, 72, 80, 84, 68)
m = length(y)

## -----------------------------------------------------------------------------
x_bar = mean(x)
s_x   = sd(x)
y_bar = mean(y)
s_y   = sd(y)

## -----------------------------------------------------------------------------
s_p = sqrt(((n - 1) * s_x ^ 2 + (m - 1) * s_y ^ 2) / (n + m - 2))

## -----------------------------------------------------------------------------
t = ((x_bar - y_bar) - 0) / (s_p * sqrt(1 / n + 1 / m))
t

## -----------------------------------------------------------------------------
1 - pt(t, df = n + m - 2)

## -----------------------------------------------------------------------------
t.test(x, y, alternative = c("greater"), var.equal = TRUE)

## -----------------------------------------------------------------------------
t_test_data = data.frame(values = c(x, y),
                         group  = c(rep("A", length(x)), rep("B", length(y))))

## -----------------------------------------------------------------------------
t_test_data

## -----------------------------------------------------------------------------
t.test(values ~ group, data = t_test_data,
       alternative = c("greater"), var.equal = TRUE)

## -----------------------------------------------------------------------------
pnorm(2, mean = 1, sd = sqrt(0.32)) - pnorm(0, mean = 1, sd = sqrt(0.32))

## -----------------------------------------------------------------------------
set.seed(42)
num_samples = 10000
differences = rep(0, num_samples)

## -----------------------------------------------------------------------------
for (s in 1:num_samples) {
  x1 = rnorm(n = 25, mean = 6, sd = 2)
  x2 = rnorm(n = 25, mean = 5, sd = 2)
  differences[s] = mean(x1) - mean(x2)
}

## -----------------------------------------------------------------------------
mean(0 < differences & differences < 2)

## -----------------------------------------------------------------------------
hist(differences, breaks = 20, 
     main   = "Empirical Distribution of D",
     xlab   = "Simulated Values of D",
     col    = "dodgerblue",
     border = "darkorange")

## -----------------------------------------------------------------------------
mean(differences)
var(differences)

## -----------------------------------------------------------------------------
set.seed(42)
diffs = replicate(10000, mean(rnorm(25, 6, 2)) - mean(rnorm(25, 5, 2)))

## -----------------------------------------------------------------------------
mean(0 < diffs & diffs < 2)
mean(diffs)
var(diffs)

## -----------------------------------------------------------------------------
set.seed(42)
mu          = 10
sample_size = 50
samples     = 100000
x_bars      = rep(0, samples)

## -----------------------------------------------------------------------------
for(i in 1:samples){
  x_bars[i] = mean(rpois(sample_size, lambda = mu))
}

## -----------------------------------------------------------------------------
x_bar_hist = hist(x_bars, breaks = 50, 
                  main = "Histogram of Sample Means",
                  xlab = "Sample Means")

## -----------------------------------------------------------------------------
c(mean(x_bars), mu)

## -----------------------------------------------------------------------------
c(sd(x_bars), sqrt(mu) / sqrt(sample_size))

## -----------------------------------------------------------------------------
mean(x_bars > mu - 2 * sqrt(mu) / sqrt(sample_size) &
     x_bars < mu + 2 * sqrt(mu) / sqrt(sample_size))

## -----------------------------------------------------------------------------
shading = ifelse(x_bar_hist$breaks > mu - 2 * sqrt(mu) / sqrt(sample_size) & 
                   x_bar_hist$breaks < mu + 2 * sqrt(mu) / sqrt(sample_size),
                  "darkorange", "dodgerblue")

x_bar_hist = hist(x_bars, breaks = 50, col = shading,
                  main = "Histogram of Sample Means, Two Standard Deviations",
                  xlab = "Sample Means")

## -----------------------------------------------------------------------------
momma_leona = data.frame(students = c(2, 6, 8, 8, 12, 16, 20, 20, 22, 26), 
                          sales = c(58, 105, 88, 118, 117, 137, 157, 169, 149, 202))

## -----------------------------------------------------------------------------
names(momma_leona)

## -----------------------------------------------------------------------------
momma_leona$sales
momma_leona$students

## -----------------------------------------------------------------------------
dim(momma_leona)
nrow(momma_leona)
ncol(momma_leona)

## -----------------------------------------------------------------------------
str(momma_leona)

## ---- echo = FALSE------------------------------------------------------------
write.csv(momma_leona, "data/momma_leona.csv", row.names = FALSE)

## -----------------------------------------------------------------------------
plot(momma_leona$students, momma_leona$sales)

## -----------------------------------------------------------------------------
plot(momma_leona$students, momma_leona$sales,
     xlab = "Students (in 1000s)",
     ylab = "Sales (in $1000s)",
     main = "Quarterly Sales vs Student Population",
     pch  = 20,
     cex  = 2,
     col  = "dodgerblue")

## -----------------------------------------------------------------------------
momma_leona_model = lm(sales ~ students, data = momma_leona)

## -----------------------------------------------------------------------------
plot(momma_leona$students, momma_leona$sales,
     xlab = "Students (in 1000s)",
     ylab = "Sales (in $1000s)",
     main = "Quarterly Sales vs Student Population",
     pch  = 20,
     cex  = 2,
     col  = "dodgerblue")
abline(momma_leona_model, lwd = 2, col = "darkorange")

## -----------------------------------------------------------------------------
plot(sales ~ students, data = momma_leona,
     xlab = "Students (in 1000s)",
     ylab = "Sales (in $1000s)",
     main = "Quarterly Sales vs Student Population",
     pch  = 20,
     cex  = 2,
     col  = "dodgerblue")
abline(momma_leona_model, lwd = 2, col = "darkorange")

